FROM node:20-alpine3.17

ARG BLOCKCHAIN_LIB_REGISTRY_READ_TOKEN=blockchain_lib_registry_read_token
ARG BLOCKCHAIN_LIB_REGISTRY_DOMAIN=blockchain_lib_registry_domain

WORKDIR /bc_coffee_contracts
COPY contracts ./contracts
COPY scripts ./scripts
COPY test ./test
COPY utils ./utils
COPY package.json ./
COPY tsconfig.json ./

RUN npm config set @blockchain-lib:registry https://$BLOCKCHAIN_LIB_REGISTRY_DOMAIN
RUN npm config set -- "//$BLOCKCHAIN_LIB_REGISTRY_DOMAIN:_authToken" "$BLOCKCHAIN_LIB_REGISTRY_READ_TOKEN"

RUN npm install --force
RUN npm run compileOnly

EXPOSE 8545
CMD npx hardhat node
